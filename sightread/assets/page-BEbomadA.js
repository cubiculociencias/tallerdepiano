import{p as e,w as z,a as u}from"./chunk-PVWAREVJ-BeAWct5i.js";import{V as w,m as y,a as A,v as _,r as b}from"./context-kPolJz0x.js";import{u as E}from"./useLazyStableRef-B5HeSgmi.js";import{T as F,u as H}from"./Toggle-vxrgibW8.js";import{S as f,C as P}from"./Canvas-C5qiJpk2.js";import{p as R}from"./sound-effects-CW6uD0gu.js";import{d as Y,m as O,n as X,o as G,q as M,e as k,c as $,f as L,h as B,P as K,S as g,j as V,p as q}from"./common-wRUDMAM3.js";const m="Arial",j=100,D=80,T=g*2;function W(t){const{ctx:n,canvasSize:r,speedState:i}=t;n.clearRect(0,0,r.width,r.height),J(t);const a=i.notes.slice(i.currentNoteIndex);for(const[s,o]of a.entries())Q(t,o,s);U(t)}function J(t){const{ctx:n,canvasSize:r,speedConfig:i}=t;n.fillStyle="black",n.strokeStyle="black";const a=D,s=C(t);Y(n,j,s,r.width),O(n,j,s-1,s+a+1);const o=s-T,l=s+a+T;X(n,v(),o,l);const{clef:c}=i;c==="treble"?G(n,S(),s):c==="bass"&&M(n,S(),s)}function S(){return j+g}function v(){return S()+g*6}function C(t){const n=D;return t.canvasSize.height/2-n/2}function Q(t,n,r){const{ctx:i,speedConfig:a}=t;i.save();const s=r*100,o=a.clef,l=C(t),c=v();let d=s+c+K/2,h=k(n,o,l);if(d<c-10){i.restore();return}$(i,d-13,33,l,n,o),L(i,d,h,"black");const x=w(n),p=x.length==2&&x[1];if(p&&(i.font=`bold 16px ${m}`,i.fillStyle="black",i.fillText(p,d-20,h+6)),t.speedConfig.displayLetter){i.font=`9px ${m}`,i.fillStyle="white";const I=x[0];i.fillText(I,d,h+3)}i.restore()}function U(t){const{ctx:n,speedConfig:r}=t,i=r.clef,a=C(t),s=y.getPressedNotes();for(let o of s.keys()){const l=k(o,i,a);let c=v()-2;L(n,c,l,"red");const d=w(o);d.length===2&&(n.fillStyle="black",B(n,V.accidentalSharp,c-17,l,g)),r.displayLetter&&(n.font=`9px ${m}`,n.fillStyle="white",n.fillText(d[0],c,l+3))}}function Z(t){const{clef:n,displayLetter:r,generator:i}=t.config,a=l=>{t.onChange({...t.config,generator:l})},s=l=>{t.onChange({...t.config,clef:l})};function o(){t.onChange({...t.config,displayLetter:!r})}return e.jsxs("div",{style:{display:"flex",position:"relative",width:"100%",height:"100%",backgroundColor:"white",flexDirection:"column",borderLeft:"1px solid black",overflowY:"auto"},children:[e.jsx(f,{height:32}),e.jsx("h3",{style:{fontSize:32,color:q.purple.primary,textAlign:"center"},children:"Settings"}),e.jsx(f,{height:36}),e.jsxs("div",{style:{fontSize:18,flexDirection:"column",textAlign:"center"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"Generator"}),e.jsx(f,{height:10}),e.jsxs("div",{style:{fontSize:14},children:[e.jsx("span",{children:" Random "}),e.jsx("input",{type:"radio",checked:i==="random",onChange:()=>a("random")})]}),e.jsx(f,{height:10}),e.jsxs("div",{style:{fontSize:14},children:[e.jsx("span",{children:" Sheet"}),e.jsx("input",{type:"radio",checked:i==="excerpts",onChange:()=>a("excerpts")})]}),e.jsx(f,{height:36}),e.jsxs("div",{style:{fontSize:18,flexDirection:"column",textAlign:"center"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"Clef"}),e.jsx(f,{height:10}),e.jsxs("div",{style:{fontSize:14},children:[e.jsx("span",{children:" Treble "}),e.jsx("input",{type:"radio",checked:n==="treble",onChange:()=>s("treble")})]}),e.jsx(f,{height:10}),e.jsxs("div",{style:{fontSize:14},children:[e.jsx("span",{children:" Bass"}),e.jsx("input",{type:"radio",checked:n==="bass",onChange:()=>s("bass")})]})]}),e.jsx(f,{height:36}),e.jsxs("div",{style:{display:"flex",fontSize:18,flexDirection:"column",alignItems:"center"},children:["Display Note Letter",e.jsx(f,{height:8}),e.jsx(F,{checked:r,onChange:o})]})]})]})}const ae=z(function({}){const[n,r]=u.useState(!1),[i,a]=u.useState(!1),s=E(()=>A("acoustic_grand_piano")),[o,l]=H("speedConfig",{clef:"treble",displayLetter:!1,generator:"random",keySignature:"C"}),[c,d]=u.useState(()=>({title:"Random Notes",notes:N(o.clef,o.keySignature),currentNoteIndex:0,complete:!1,speed:2,correct:0,startTime:new Date,lastNoteHitTime:new Date}));return u.useEffect(()=>{const h=x=>{te(c,d,s,x,i)};return y.subscribe(h),function(){y.unsubscribe(h)}},[s,i,d,c]),e.jsxs("div",{children:[e.jsx("title",{children:"Speed Training"}),e.jsx(e.Fragment,{children:e.jsx("div",{style:{position:"absolute",top:55,width:300,height:"calc(100% - 55px)",right:0,visibility:n?"visible":"hidden",zIndex:2},children:e.jsx(Z,{open:n,onChange:l,config:o})})}),e.jsxs("div",{style:{backgroundColor:"white",width:"100vw",height:"calc(100vh - 55px)",position:"fixed",top:55,display:"flex",flexDirection:"column",justifyContent:"center"},children:[e.jsxs("h2",{style:{fontSize:48,alignSelf:"center"},children:[" ",c.title]}),e.jsxs("div",{children:[e.jsx("div",{style:{position:"relative",height:300},children:e.jsx(P,{render:(h,x)=>{W({ctx:h,canvasSize:x,speedState:c,speedConfig:o})}})}),e.jsxs("div",{style:{display:"flex",justifyContent:"center"},children:[e.jsx(ee,{speedState:c}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("button",{style:{width:150,height:40,backgroundColor:"#C4C4C4",border:"1px solid black"},onClick:()=>d({...c,complete:!1,currentNoteIndex:0,startTime:new Date,lastNoteHitTime:new Date,correct:0,speed:0}),children:"Restart"}),e.jsx(f,{height:20}),e.jsx("button",{style:{width:150,height:40,backgroundColor:"#C4C4C4",border:"1px solid black"},onClick:()=>d({complete:!1,notes:N(o.clef,o.keySignature),currentNoteIndex:0,startTime:new Date,lastNoteHitTime:new Date,correct:0,title:"Random",speed:0}),children:"Next"})]})]})]})]})]})});function ee({speedState:t}){const{correct:n,currentNoteIndex:r,lastNoteHitTime:i,startTime:a}=t,s=b(100*(n/r),2),o=b(r/(i.getTime()-a.getTime())*1e3*60,2);return e.jsxs("div",{style:{display:"flex",justifyContent:"center",visibility:t.complete?"visible":"hidden"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:200},children:[e.jsx("span",{style:{fontSize:32},children:"Speed"}),e.jsx(f,{height:8}),e.jsxs("span",{children:[o," notes/minute"]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",width:200},children:[e.jsx("span",{style:{fontSize:32},children:"Accuracy"}),e.jsx(f,{height:8}),e.jsxs("span",{children:[s,"%"]})]})]})}function te(t,n,r,i,a){if(t.complete)return;const{note:s,type:o,velocity:l}=i;if(o==="up"){r.stopNote(s,l);return}const c=t.notes[t.currentNoteIndex],d=t.currentNoteIndex>=t.notes.length-1;s===c?(o==="down"&&!a&&r.playNote(s,l),n({...t,currentNoteIndex:t.currentNoteIndex+1,correct:t.correct+1,lastNoteHitTime:new Date,complete:d})):(R(),n({...t,currentNoteIndex:t.currentNoteIndex+1,lastNoteHitTime:new Date,complete:d}))}function N(t,n){let r=4,i=5;return t==="bass"&&(r=2,i=3),Array.from({length:20}).map(()=>_(r,i,"C"))}export{ae as default};
