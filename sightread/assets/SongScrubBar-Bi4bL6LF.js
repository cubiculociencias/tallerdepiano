import{a as r,p as s}from"./chunk-PVWAREVJ-BeAWct5i.js";import{u as S,j as X,t as L,o as w,c as z}from"./context-kPolJz0x.js";import{u as P}from"./Dropdown-B9h-t97s.js";import{u as F,e as $}from"./Canvas-C5qiJpk2.js";const U={capture:!0};function H({height:O,setRange:B=()=>{},onSeek:T=()=>{},onClick:M=()=>{},rangeSelection:u}){const[A,i]=r.useState(!1),x=r.useRef(null),d=r.useRef(null),{width:o,measureRef:C}=F(),v=r.useRef(null),b=r.useRef(null),R=r.useRef(null),h=r.useRef(null),f=r.useRef(null),p=r.useRef(0),e=S(),l=r.useRef(!1),c=r.useRef(!1),N=X(e.song),D=r.useRef(null),k=r.useRef(null),m=r.useRef(!1),g=r.useCallback(t=>L((t.clientX-p.current)/o,{min:0,max:1}),[o]);$(()=>{if(!x.current)return;const t=e.getTime()/e.getDuration();if(x.current.style.transform=`translateX(${t*o}px)`,v.current){const n=e.getRealTimeDuration(0,e.getTime());v.current.innerText=String(w(n))}if(f.current&&u){let n=u.start,a=u.end;a<n&&([n,a]=[a,n],l.current=!l.current,c.current=!c.current),f.current.style.left=p.current+n/e.getDuration()*o+"px",f.current.style.width=(a-n)/e.getDuration()*o+"px"}}),r.useEffect(()=>{d.current&&(p.current=d.current.getBoundingClientRect().x)},[o]);const E=r.useCallback(t=>{const a=g(t)*e.getDuration();T(),e.seek(a)},[e,g,T]);let y=r.useRef(!1);return P("pointerdown",t=>{const n=t.target;D.current?.contains(n)&&!l.current&&!c.current&&(m.current=!0,e.isPlaying()&&(y.current=!0,e.pause()),E(t))}),P("pointerup",t=>{const n=t.target,a=l.current||c.current||m.current,j=k.current?.contains(n);(a||j)&&t.stopPropagation(),l.current=!1,c.current=!1,m.current=!1,y.current&&(y.current=!1,e.play())},void 0,U),P("pointermove",t=>{const a=g(t)*e.getDuration();(l.current||c.current)&&u?(l.current?u.start=a:u.end=a,B(u)):m.current&&E(t)}),s.jsxs("div",{className:"relative flex w-full touch-none border-b border-b-black bg-gray-300 select-none",onClick:M,style:{height:O},ref:k,onPointerMove:t=>{if(!e.getSong()||!R.current||!b.current||!h.current)return;const a=g(t)*e.getDuration(),j=e.getMeasureForTime(a);h.current.style.left=`${L(t.clientX-p.current-24,{min:0,max:o-90})}px`,R.current.innerText=String(j?.number),b.current.innerText=w(e.getRealTimeDuration(0,a))},children:[s.jsxs("div",{className:z(A?"flex":"hidden","absolute z-30 min-w-max items-center justify-between gap-8","-top-1 rounded-lg bg-black/90 px-4 py-2","-translate-y-full"),ref:h,children:[s.jsxs("span",{className:"text-gray-300",children:["Time: ",s.jsx("span",{className:"text-purple-hover text-sm",ref:b})]}),s.jsxs("span",{className:"text-gray-300",children:["Measure: ",s.jsx("span",{className:"text-purple-hover text-sm",ref:R})]})]}),s.jsx("span",{ref:v,className:"min-w-[80px] self-center px-4 py-2 text-black"}),s.jsxs("div",{ref:D,className:"relative h-4 grow self-center overflow-hidden rounded-full",onPointerOver:()=>i(!0),onPointerOut:()=>i(!1),children:[s.jsx("div",{ref:d,className:"absolute"}),s.jsx("div",{ref:C,className:"absolute h-full w-full bg-gray-400"}),s.jsx("div",{ref:x,className:"bg-purple-primary pointer-events-none absolute h-full w-full",style:{left:-o}})]}),s.jsx("span",{className:"min-w-[80px] self-center px-4 py-2 text-black",children:N?w(e.getRealTimeDuration(0,N.duration)):"00:00"}),u&&s.jsxs("div",{ref:f,className:"pointer-events-none absolute flex h-full items-center",children:[s.jsx("div",{className:"bg-purple-dark/40 absolute h-4 w-[calc(100%-10px)]"}),s.jsx("div",{className:"bg-purple-dark/90 hover:bg-purple-hover/90 pointer-events-auto absolute left-0 h-6 w-6 -translate-x-1/2 cursor-pointer rounded-full transition",onPointerEnter:()=>i(!0),onPointerLeave:()=>i(!1),onPointerDown:()=>l.current=!0}),s.jsx("div",{className:"bg-purple-dark/90 hover:bg-purple-hover/90 pointer-events-auto absolute right-0 h-6 w-6 translate-x-1/2 cursor-pointer rounded-full transition",onPointerDown:()=>c.current=!0,onPointerEnter:()=>i(!0),onPointerLeave:()=>i(!1)})]})]})}export{H as S};
